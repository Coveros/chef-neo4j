#
# Generated by Chef for <%= node['fqdn'] %> 
# Local modifications will be overridden
#

<VirtualHost *:80>
  ServerSignature Off
  DocumentRoot <%= node['neo4j']['web_path'] %>/current/public

  LogLevel warn
  ErrorLog    <%= node['apache']['log_dir'] %>/neo4j-web-error.log
  CustomLog   <%= node['apache']['log_dir'] %>/neo4j-web-access.log combined

  RewriteEngine On
  RewriteCond %{HTTPS} off
  RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}
  #RewriteLog <%= node['apache']['log_dir'] %>/neo4j-web-interface-rewrite.log
</VirtualHost>

<VirtualHost *:443>
  ServerSignature Off
  DocumentRoot <%= node['neo4j']['web_path'] %>/current/public

  LogLevel warn
  ErrorLog    <%= node['apache']['log_dir'] %>/neo4j-web-error.log
  CustomLog   <%= node['apache']['log_dir'] %>/neo4j-web-access.log combined

  SSLEngine on
  SSLCertificateFile    <%= node['apache']['dir'] %>/ssl/neo4j.pem
  SSLCertificateKeyFile <%= node['apache']['dir'] %>/ssl/neo4j.key

  LoadModule passenger_module <%= node['neo4j']['web_path'] %>/.rvm/gems/<%= node['neo4j']['ruby_version'] %>/gems/passenger-<%= node['neo4j']['passenger_version'] %>/ext/apache2/mod_passenger.so
  PassengerRoot <%= node['neo4j']['web_path'] %>/.rvm/gems/<%= node['neo4j']['ruby_version'] %>/gems/passenger-<%= node['neo4j']['passenger_version'] %>
  PassengerRuby <%= node['neo4j']['web_path'] %>/.rvm/wrappers/<%= node['neo4j']['ruby_version'] %>/ruby

  PassengerLogLevel 0
  PassengerDebugLogFile <%= node['apache']['log_dir'] %>/neo4j-web-pessenger-error.log

  <Directory <%= node['neo4j']['web_path'] %>/current/public>
    Allow from all
    Options -MultiViews
  </Directory>
</VirtualHost>
